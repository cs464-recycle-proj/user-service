# User Service Configuration
replicaCount: 2

image:
  repository: registry.digitalocean.com/cs464-project/user-service
  pullPolicy: Always
  tag: "latest"

imagePullSecrets:
  - name: registry-cs464-project

service:
  type: ClusterIP
  port: 8082
  targetPort: 8082

ingress:
  enabled: false  # Only internal access via Kubernetes DNS

resources:
  limits:
    cpu: 500m
    memory: 512Mi
  requests:
    cpu: 250m
    memory: 256Mi

autoscaling:
  enabled: true
  minReplicas: 2
  maxReplicas: 10
  targetCPUUtilizationPercentage: 80
  targetMemoryUtilizationPercentage: 80

# Environment Variables
env:
  SERVER_PORT: "8082"
  
  # Spring Boot / Java Configuration
  SPRING_PROFILES_ACTIVE: "production"
  JAVA_OPTS: "-Xms256m -Xmx512m"
  
  # Database configuration (Spring Boot style)
  DATABASE_URL: "jdbc:postgresql://user-service-postgresql:5432/user_db"
  DATABASE_USERNAME: "userservice"
  
  # Legacy/Direct PostgreSQL environment variables (if needed)
  DB_HOST: "user-service-postgresql"
  DB_PORT: "5432"
  DB_USER: "userservice"
  DB_NAME: "user_db"
  PGHOST: "user-service-postgresql"
  PGPORT: "5432"
  PGDATABASE: "user_db"
  PGUSER: "userservice"
  
  # Logging Configuration
  LOG_LEVEL: "info"
  
  # CORS Configuration
  CORS_ALLOWED_ORIGINS: "*"
  
  # Health Check
  HEALTH_CHECK_PATH: "/actuator/health"

# PostgreSQL Configuration
postgresql:
  enabled: true
  image:
    registry: docker.io
    repository: bitnamilegacy/postgresql
    tag: 17.2.0-debian-12-r4
  auth:
    username: userservice
    password: ""  # Override with secrets in deployment
    database: user_db
  primary:
    persistence:
      enabled: true
      size: 10Gi
    resources:
      limits:
        cpu: 1000m
        memory: 1Gi
      requests:
        cpu: 250m
        memory: 256Mi
    initdb:
      scripts:
        init.sql: |
          -- Create user_service schema if it doesn't exist
          CREATE SCHEMA IF NOT EXISTS user_service;
          GRANT ALL PRIVILEGES ON SCHEMA user_service TO userservice;
